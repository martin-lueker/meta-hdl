From 750d85ea5d521725d9d59ba5276fbf6447fd0ee6 Mon Sep 17 00:00:00 2001
From: Nathan Rossi <nathan@nathanrossi.com>
Date: Sat, 21 Mar 2020 18:46:15 +1000
Subject: [PATCH] common/cmake/env.cmake: Handle add_conda_pip with NO_EXE

Signed-off-by: Nathan Rossi <nathan@nathanrossi.com>
---
 common/cmake/env.cmake | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/common/cmake/env.cmake b/common/cmake/env.cmake
index 60a41de507..5b824fd360 100644
--- a/common/cmake/env.cmake
+++ b/common/cmake/env.cmake
@@ -319,15 +319,17 @@ function(ADD_CONDA_PIP)
       )
     add_dependencies(clean_pip _clean_pip_${NAME})
   else()
-    if(DEFINED ENV{${binary_upper}})
-      set(${binary_upper} $ENV{${binary_upper}})
-    else()
-      find_program(${binary_upper} ${NAME})
-    endif()
-    if(NOT ${binary_upper})
-      message(FATAL_ERROR "Could not find program ${NAME}.")
+    if(NOT ADD_CONDA_PIP_NO_EXE)
+      if(DEFINED ENV{${binary_upper}})
+        set(${binary_upper} $ENV{${binary_upper}})
+      else()
+        find_program(${binary_upper} ${NAME})
+      endif()
+      if(NOT ${binary_upper})
+        message(FATAL_ERROR "Could not find program ${NAME}.")
+      endif()
+      set_target_properties(env PROPERTIES ${binary_upper} ${${binary_upper}})
     endif()
-    set_target_properties(env PROPERTIES ${binary_upper} ${${binary_upper}})
     set_target_properties(env PROPERTIES ${binary_upper}_TARGET "")
   endif()
 endfunction()
